apply plugin: "kotlinx-atomicfu"

kotlin {
    targets {
        if (project.ext.ideaActive) {
            fromPreset(project.ext.ideaPreset, 'darwin')
        } else {
            fromPreset(presets.iosArm64, 'iosArm64')
            fromPreset(presets.iosArm32, 'iosArm32')
            fromPreset(presets.iosX64, 'iosX64')
            fromPreset(presets.macosX64, 'macosX64')
            fromPreset(presets.tvosArm64, 'tvosArm64')
            fromPreset(presets.tvosX64, 'tvosX64')
            fromPreset(presets.watchosArm32, 'watchosArm32')
            fromPreset(presets.watchosArm64, 'watchosArm64')
            fromPreset(presets.watchosX86, 'watchosX86')
            fromPreset(presets.watchosX64, 'watchosX64')
            fromPreset(presets.iosSimulatorArm64, 'iosSimulatorArm64')
            fromPreset(presets.watchosSimulatorArm64, 'watchosSimulatorArm64')
            fromPreset(presets.tvosSimulatorArm64, 'tvosSimulatorArm64')
            fromPreset(presets.macosArm64, 'macosArm64')
        }
    }
    sourceSets {
        darwinMain.dependencies {
            implementation(libs.kotlinx.coroutines.core)
            implementation(libs.kotlinx.atomicfu)
        }

        darwinMain { dependsOn commonMain }
        darwinTest

        if (!project.ext.ideaActive) {
            configure([iosArm32Main, iosArm64Main, iosX64Main, iosSimulatorArm64Main,
                       macosX64Main, macosArm64Main,
                       tvosArm64Main, tvosX64Main, tvosSimulatorArm64Main,
                       watchosArm32Main, watchosArm64Main, watchosX86Main, watchosX64Main, watchosSimulatorArm64Main]) {
                dependsOn darwinMain
            }

            configure([iosArm32Test, iosArm64Test, iosX64Test, iosSimulatorArm64Test,
                       macosX64Test, macosArm64Test,
                       tvosArm64Test, tvosX64Test, tvosSimulatorArm64Test,
                       watchosArm32Test, watchosArm64Test, watchosX86Test, watchosX64Test, watchosSimulatorArm64Test]) {
                dependsOn darwinTest
            }
        }
    }
}

project.ext.set("hasNative", true)
